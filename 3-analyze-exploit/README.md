# Exploit Code Analyzer

A LangChain-powered tool for analyzing exploit code files to identify vulnerabilities, attack vectors, and security implications.

## Features

- **Vulnerability Identification**: Automatically identifies the type of vulnerability and CVE if available
- **Technical Analysis**: Analyzes the attack methodology and implementation details
- **Payload Extraction**: Identifies specific attack payloads and vectors used
- **Impact Assessment**: Evaluates potential security impact and severity
- **IOC Generation**: Extracts indicators of compromise for detection
- **Mitigation Recommendations**: Provides security recommendations and countermeasures
- **Multiple Output Formats**: Supports both human-readable and JSON output

## Prerequisites

1. **Python Dependencies**: Install the required packages:
   ```bash
   pip install langchain-core langchain-openai
   ```

2. **OpenAI API Key**: Set your OpenAI API key as an environment variable:
   ```bash
   export OPENAI_API_KEY="your-api-key-here"
   ```

## Usage

### Basic Usage

Analyze a single exploit file:
```bash
python3 3-analyze-exploit.py exploit_CVE-2023-32235.py
```

### JSON Output

Output results as JSON to stdout:
```bash
python3 3-analyze-exploit.py exploit_CVE-2023-32235.py --json
```

Pipe JSON output to a file:
```bash
python3 3-analyze-exploit.py exploit_CVE-2023-32235.py --json > results.json
```

### Directory Analysis

Analyze all exploit files in a directory:
```bash
python3 3-analyze-exploit.py /path/to/exploits/
```

Specify file extensions to analyze:
```bash
python3 3-analyze-exploit.py /path/to/exploits/ --extensions .py .rb .c .sh
```

### Save Results to File

Save detailed results to a JSON file:
```bash
python3 3-analyze-exploit.py exploit_CVE-2023-32235.py -o analysis_results.json
```

### Advanced Options

```bash
python3 3-analyze-exploit.py exploit_file.py \
  --model gpt-4 \
  --temperature 0.2 \
  --output detailed_analysis.json
```

## Command Line Options

| Option | Description |
|--------|-------------|
| `target` | Path to exploit file or directory to analyze |
| `-o, --output` | Output file for JSON results |
| `--json` | Output results as JSON to stdout |
| `-m, --model` | OpenAI model to use (default: gpt-5) |
| `-t, --temperature` | Model temperature (default: 0.1) |
| `--extensions` | File extensions to analyze for directory mode |

## Output Format

### Human-Readable Output

The default output provides a comprehensive summary including:

```
================================================================================
EXPLOIT ANALYSIS SUMMARY
================================================================================
File: exploit_CVE-2023-32235.py
Vulnerability Type: Path Traversal
CVE ID: CVE-2023-32235
Severity: High
Target Software: Ghost CMS < 5.42.1
Attack Vector: Network
Confidence Score: 0.95

Impact Description:
  Allows reading arbitrary files within the active theme's folder structure...

Identified Payloads:
  1. ../../package.json
  2. ../../../.env
  3. ..%2f..%2fconfig.json

Indicators of Compromise:
  1. HTTP requests to /assets/built/ with ../ sequences
  2. Successful 200 responses to traversal attempts
  3. Access to sensitive files like .env, package.json

Mitigation Recommendations:
  1. Update Ghost CMS to version 5.42.1 or later
  2. Implement proper input validation
  3. Use allow-list for accessible files
  4. Monitor for directory traversal patterns
```

### JSON Output

When using `--json`, the output is structured JSON:

```json
{
  "analysis_count": 1,
  "generated_at": "2024-01-15T10:30:00",
  "analyses": [
    {
      "file_path": "exploit_CVE-2023-32235.py",
      "vulnerability_type": "Path Traversal",
      "cve_id": "CVE-2023-32235",
      "severity": "High",
      "target_software": "Ghost CMS < 5.42.1",
      "attack_vector": "Network",
      "impact_description": "Allows reading arbitrary files...",
      "technical_details": {
        "method": "Directory traversal via /assets/built/ endpoint",
        "encoding_bypasses": ["URL encoding", "Double encoding"]
      },
      "payloads_identified": [
        "../../package.json",
        "../../../.env"
      ],
      "indicators_of_compromise": [
        "HTTP requests to /assets/built/ with ../ sequences"
      ],
      "mitigation_recommendations": [
        "Update Ghost CMS to version 5.42.1 or later"
      ],
      "confidence_score": 0.95,
      "analysis_timestamp": "2024-01-15T10:30:00"
    }
  ]
}
```

## Examples

### Example 1: Analyze Single File with JSON Output

```bash
python3 3-analyze-exploit.py exploit_CVE-2023-32235.py --json | jq '.analyses[0].severity'
```

### Example 2: Batch Analysis with Results Processing

```bash
# Analyze all Python exploits and extract high-severity ones
python3 3-analyze-exploit.py /exploits/ --extensions .py --json | \
  jq '.analyses[] | select(.severity == "High" or .severity == "Critical")'
```

### Example 3: Generate Security Report

```bash
# Create a comprehensive security report
python3 3-analyze-exploit.py /exploits/ -o security_report.json
```

## Testing

Run the test suite:
```bash
python3 test_exploit_analyzer.py
```

Run the demonstration:
```bash
python3 test_exploit_analyzer.py demo
```

## Supported File Types

The analyzer supports various exploit file extensions:
- `.py` - Python exploits
- `.rb` - Ruby exploits  
- `.pl` - Perl exploits
- `.sh` - Shell scripts
- `.c` - C exploits
- `.cpp` - C++ exploits
- `.java` - Java exploits
- `.js` - JavaScript exploits

## Security Considerations

- **API Key Security**: Keep your OpenAI API key secure and never commit it to version control
- **Code Execution**: The analyzer only reads and analyzes code; it does not execute exploit code
- **Data Privacy**: Exploit code is sent to OpenAI's API for analysis; consider data sensitivity
- **Rate Limits**: Be aware of OpenAI API rate limits when analyzing large directories

## Troubleshooting

### Common Issues

1. **Missing API Key**:
   ```
   Error: OPENAI_API_KEY environment variable is not set
   ```
   Solution: Set your OpenAI API key as shown in prerequisites

2. **File Not Found**:
   ```
   Error: Target path does not exist: /path/to/file
   ```
   Solution: Verify the file path is correct

3. **Empty File**:
   ```
   ValueError: Exploit file is empty: file.py
   ```
   Solution: Ensure the file contains code to analyze

## Contributing

To extend the analyzer:

1. **Add New Analysis Types**: Extend the `ExploitAnalysisOutput` model
2. **Custom Prompts**: Modify the prompt template in `_setup_analysis_chain()`
3. **New File Types**: Add extensions to the default list in `analyze_directory()`
4. **Output Formats**: Add new output formatters in the main function

## License

MIT License - see project root for details.
